import{k as x,l as K,m as g,o as w,r as E,s as v,p as H}from"./index-jJ-r5mz2.js";const b=x.create({baseURL:"/api",timeout:5e4,headers:{"Content-Type":"application/json"}});b.interceptors.response.use(e=>e.data,e=>Promise.reject(e));const c=e=>b({...e}),z=e=>c({url:"/models",method:"GET",signal:e}),N=()=>["/models"],J=e=>{const{query:t}=e??{};return{queryKey:t?.queryKey??N(),queryFn:({signal:o})=>z(o),...t}};function V(e,t){const n=J(e),s=K(n);return s.queryKey=n.queryKey,s}const W=(e,t)=>c({url:`/models/${e}`,method:"GET",signal:t}),L=e=>[`/models/${e}`],X=(e,t)=>{const{query:n}=t??{};return{queryKey:n?.queryKey??L(e),queryFn:({signal:a})=>W(e,a),enabled:!!e,...n}};function Y(e,t,n){const s=X(e,t),o=K(s);return o.queryKey=s.queryKey,o}const Z=e=>c({url:`/models/${e}`,method:"DELETE"}),ee=e=>{const t=["deleteModelModelsModelIdDelete"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a}=o??{};return Z(a)},...n}},te=(e,t)=>{const n=ee(e);return g(n)},ne=(e,t)=>c({url:`/models/${e}`,method:"PUT",headers:{"Content-Type":"application/json"},data:t}),oe=e=>{const t=["updateModelModelsModelIdPut"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return ne(a,i)},...n}},se=(e,t)=>{const n=oe(e);return g(n)},ae=(e,t)=>c({url:`/models/${e}`,method:"PATCH",headers:{"Content-Type":"application/json"},data:t}),ie=e=>{const t=["updateModelStateModelsModelIdPatch"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return ae(a,i)},...n}},re=(e,t)=>{const n=ie(e);return g(n)},ue=(e,t)=>c({url:`/models/${e}/state`,method:"GET",signal:t}),B=e=>[`/models/${e}/state`],le=(e,t)=>{const{query:n}=t??{};return{queryKey:n?.queryKey??B(e),queryFn:({signal:a})=>ue(e,a),enabled:!!e,...n}};function de(e,t,n){const s=le(e,t),o=K(s);return o.queryKey=s.queryKey,o}const ce=(e,t)=>{const n=new FormData;return n.append("name",e.name),n.append("description",e.description),n.append("model_type",e.model_type),e.attacker_file!==void 0&&n.append("attacker_file",e.attacker_file),e.defender_file!==void 0&&n.append("defender_file",e.defender_file),n.append("target_file",e.target_file),c({url:"/models/",method:"POST",headers:{"Content-Type":"multipart/form-data"},data:n,signal:t})},me=e=>{const t=["createModelsModelsPost"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{data:a}=o??{};return ce(a)},...n}},ye=(e,t)=>{const n=me(e);return g(n)},Me=(e,t)=>c({url:`/models/${e}/inspect`,method:"GET",signal:t}),pe=e=>[`/models/${e}/inspect`],Fe=(e,t)=>{const{query:n}=t??{};return{queryKey:n?.queryKey??pe(e),queryFn:({signal:a})=>Me(e,a),enabled:!!e,...n}};function fe(e,t,n){const s=Fe(e,t),o=K(s);return o.queryKey=s.queryKey,o}const ge=(e,t)=>c({url:`/models/${e}/files`,method:"GET",signal:t}),R=e=>[`/models/${e}/files`],qe=(e,t)=>{const{query:n}=t??{};return{queryKey:n?.queryKey??R(e),queryFn:({signal:a})=>ge(e,a),enabled:!!e,...n}};function Ce(e,t,n){const s=qe(e,t),o=K(s);return o.queryKey=s.queryKey,o}const Ie=(e,t)=>c({url:`/models/${e}/files`,method:"PUT",headers:{"Content-Type":"application/json"},data:t}),Ke=e=>{const t=["updateModelFileContentModelsModelIdFilesPut"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return Ie(a,i)},...n}},Pe=(e,t)=>{const n=Ke(e);return g(n)},Se=(e,t,n)=>c({url:`/models/${e}/files`,method:"POST",headers:{"Content-Type":"application/json"},data:t,signal:n}),Oe=e=>{const t=["createModelFileModelsModelIdFilesPost"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return Se(a,i)},...n}},he=(e,t)=>{const n=Oe(e);return g(n)},Ge=(e,t)=>c({url:`/models/${e}/files`,method:"DELETE",headers:{"Content-Type":"application/json"},data:t}),Ae=e=>{const t=["deleteModelFileModelsModelIdFilesDelete"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return Ge(a,i)},...n}},De=(e,t)=>{const n=Ae(e);return g(n)},Te=(e,t,n)=>c({url:`/models/${e}/files/content`,method:"POST",headers:{"Content-Type":"application/json"},data:t,signal:n}),Ee=e=>{const t=["getModelFileContentModelsModelIdFilesContentPost"],{mutation:n}={mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return Te(a,i)},...n}},ke=(e,t)=>{const n=Ee();return g(n)},Qe=(e,t,n)=>c({url:`/models/${e}/files/directories`,method:"POST",headers:{"Content-Type":"application/json"},data:t,signal:n}),$e=e=>{const t=["createModelDirectoryModelsModelIdFilesDirectoriesPost"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return Qe(a,i)},...n}},Ue=(e,t)=>{const n=$e(e);return g(n)},ve=(e,t,n)=>{const s=new FormData;return s.append("file",t.file),s.append("file_path",t.file_path),c({url:`/models/${e}/files/upload`,method:"POST",headers:{"Content-Type":"multipart/form-data"},data:s,signal:n})},we=e=>{const t=["uploadModelFileModelsModelIdFilesUploadPost"],{mutation:n}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:t}}:{mutation:{mutationKey:t}};return{mutationFn:o=>{const{modelId:a,data:i}=o??{};return ve(a,i)},...n}},Ne=(e,t)=>{const n=we(e);return g(n)},_e=(e,t)=>c({url:`/models/${e}/dind/packets`,method:"GET",signal:t}),je=e=>[`/models/${e}/dind/packets`],be=(e,t)=>{const{query:n}=t??{};return{queryKey:n?.queryKey??je(e),queryFn:({signal:a})=>_e(e,a),enabled:!!e,...n}};function Re(e,t,n){const s=be(e,t),o=K(s);return o.queryKey=s.queryKey,o}const xe=()=>{const e=w(),{data:t,...n}=V({query:{select:o=>o.data?.filter(a=>a.model_type==="scenario")??[]}}),s=ye({mutation:{onSuccess:o=>{e.invalidateQueries({queryKey:N()}),H(o.message??"创建场景成功")},onError:o=>{v("创建场景失败",o.detail)}}});return{scenarios:t,createScenario:o=>s.mutate({data:{...o,model_type:"scenario"}}),createScenarioAsync:o=>s.mutateAsync({data:{...o,model_type:"scenario"}}),...n}},He=e=>{const t=w(),[n,s]=E.useState(!1),o=!!e,{data:a,...i}=Y(e,{query:{enabled:o,select:l=>l.data??null}}),{data:M,...P}=de(e,{query:{enabled:o,refetchInterval:n?2e3:!1,select:l=>l.data??null}});E.useEffect(()=>{M&&M.state!=="pending"&&M.state!=="building"&&s(!1)},[M]);const C=()=>{e&&(t.invalidateQueries({queryKey:N()}),t.invalidateQueries({queryKey:L(e)}),t.invalidateQueries({queryKey:B(e)}))},f=te({mutation:{onSuccess:C}}),m=se({mutation:{onSuccess:C}}),r=re({mutation:{onSuccess:()=>{C(),s(!0)}}});if(!e){const l=async()=>Promise.resolve(new Response),p=()=>{};return{scenario:null,status:null,containers:null,scenarioQuery:{isInitialLoading:!1},statusQuery:{isInitialLoading:!1},isUpdatingState:!1,deleteScenario:p,deleteScenarioAsync:l,updateScenario:p,updateScenarioAsync:l,partialUpdateScenario:p,partialUpdateScenarioAsync:l,updateState:p,updateStateAsync:l}}return{scenario:a,status:M,containers:a?.compose_info??null,scenarioQuery:i,statusQuery:P,isUpdatingState:r.isPending,deleteScenario:l=>f.mutate(l),deleteScenarioAsync:f.mutateAsync,updateScenario:m.mutate,updateScenarioAsync:m.mutateAsync,partialUpdateScenario:m.mutate,partialUpdateScenarioAsync:m.mutateAsync,updateState:r.mutate,updateStateAsync:r.mutateAsync}},ze=e=>{const{data:t,isPending:n,isSuccess:s,error:o}=fe(e,{query:{select:a=>a.data?.containers??{}}});return E.useMemo(()=>{let a,i,M;const P=new Map,C=new Map,f=new Map;if(t){for(const m in t)if(Object.prototype.hasOwnProperty.call(t,m)){const r=t[m];if(r&&r.Config&&r.Config.Labels){const l=r.Config.Labels["com.docker.compose.service"],p=r.HostConfig?.PortBindings?.["8000/tcp"]?.[0]?.HostPort,S=r.HostConfig?.PortBindings?.["2222/tcp"]?.[0]?.HostPort,q=r.NetworkSettings?.Ports?.["8080/tcp"]?.[0]?.HostPort,G=p?parseInt(p,10):void 0,O=S?parseInt(S,10):void 0,h=q?parseInt(q,10):void 0,A=r.HostConfig?.NetworkMode??"bridge",$=r.NetworkSettings?.Networks?.[A]?.IPAddress??"",u=r.State.Status,d=Math.floor((new Date().getTime()-new Date(r.State.CreatedAt).getTime())/6e4);l==="attacker"?a=r:l==="defender"?i=r:l==="target"&&(M=r),P.set(m,{mcpPort:G&&!isNaN(G)?G:void 0,sshPort:O&&!isNaN(O)?O:void 0,targetEntrancePort:h&&!isNaN(h)?h:void 0}),C.set(m,$),f.set(m,{status:u,runningTime:d})}}}return{portMap:P,ipAddressMap:C,statusMap:f,attackerContainer:a,attackerContainerName:a?.Name?.slice(1),defenderContainer:i,defenderContainerName:i?.Name?.slice(1),targetContainer:M,targetContainerName:M?.Name?.slice(1),isPending:n,isSuccess:s,error:o}},[t,n,s,o])},Je=e=>{const t=w(),n=!!e,s=()=>{e&&t.invalidateQueries({queryKey:R(e)})},o=u=>{if(u===0)return"0 B";const d=1024,k=["B","KB","MB","GB"],D=Math.floor(Math.log(u)/Math.log(d));return parseFloat((u/Math.pow(d,D)).toFixed(2))+" "+k[D]},a=u=>{const d={};function k(y){return Object.keys(y).sort((F,T)=>{const U=y[F],I=y[T],Q=U.type==="directory",j=I.type==="directory";return Q&&!j?-1:!Q&&j?1:F.localeCompare(T)})}function D(y,F,T){if(y.type==="directory"){const U=y.children?k(y.children).map(I=>F?`${F}/${I}`:I):[];if(d[F]={name:T,children:U},y.children)for(const[I,Q]of Object.entries(y.children))D(Q,F?`${F}/${I}`:I,I)}else y.type==="file"&&(d[F]={name:`${T} (${o(y.size??0)})`})}const _=".";if(d[_]={name:"文件根目录",children:u.children?k(u.children):[]},u.children)for(const[y,F]of Object.entries(u.children))D(F,y,y);return{items:d,rootItemId:_}},{data:i,...M}=Ce(e,{query:{enabled:n,select:u=>u.data?.file_tree??null}}),{items:P,rootItemId:C}=i?a(i):{items:{},rootItemId:"."},f=ke(),m=he({mutation:{onSuccess:s}}),r=Pe({mutation:{onSuccess:s}}),l=De({mutation:{onSuccess:s}}),p=Ue({mutation:{onSuccess:s}}),S=Ne({mutation:{onSuccess:s}}),{data:q,isPending:G,isSuccess:O,isError:h,error:A}=K({queryKey:["readme",e],queryFn:async()=>e?(await f.mutateAsync({modelId:e,data:{file_path:"target/README.md"}})).data?.content:null,enabled:n,retry:!1});E.useEffect(()=>{O&&!q&&n&&v("README.md为空或不存在"),h&&A&&v("获取靶机README.md失败",A.message)},[O,h,q,A,n]);const $=E.useMemo(()=>q?Le(q):null,[q]);if(!e){const u=async()=>Promise.resolve(new Response),d=()=>{};return{fileTree:null,fileTreeItems:{},rootItemId:".",fileTreeQuery:{isInitialLoading:!1},readmeContent:null,readmeMermaidContents:null,isReadmeLoading:!1,getFileContent:d,getFileContentAsync:u,isGettingContent:!1,createFile:d,createFileAsync:u,isCreatingFile:!1,updateFile:d,updateFileAsync:u,isUpdatingFile:!1,deleteFile:d,deleteFileAsync:u,isDeletingFile:!1,createDirectory:d,createDirectoryAsync:u,isCreatingDirectory:!1,uploadFile:d,uploadFileAsync:u,isUploadingFile:!1}}return{fileTree:i,fileTreeItems:P,rootItemId:C,fileTreeQuery:M,readmeContent:q,readmeMermaidContents:$,isReadmeLoading:G,getFileContent:f.mutate,getFileContentAsync:f.mutateAsync,isGettingContent:f.isPending,createFile:m.mutate,createFileAsync:m.mutateAsync,isCreatingFile:m.isPending,updateFile:r.mutate,updateFileAsync:r.mutateAsync,isUpdatingFile:r.isPending,deleteFile:l.mutate,deleteFileAsync:l.mutateAsync,isDeletingFile:l.isPending,createDirectory:p.mutate,createDirectoryAsync:p.mutateAsync,isCreatingDirectory:p.isPending,uploadFile:S.mutate,uploadFileAsync:S.mutateAsync,isUploadingFile:S.isPending}};function Le(e){const t=/```mermaid\n([\s\S]*?)\n```/g,n=[...e.matchAll(t)];return n.length===0?(console.log("Error: No Mermaid syntax blocks (```mermaid...) were found in the provided content."),null):n.map(o=>o[1].trim())}export{He as a,ze as b,V as c,ye as d,Y as e,de as f,te as g,se as h,re as i,N as j,L as k,B as l,R as m,Je as n,je as o,Re as p,xe as u};
