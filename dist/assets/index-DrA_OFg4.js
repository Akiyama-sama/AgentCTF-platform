import{r as v,j as r,i as Ce,R as me,k as Me,l as xe,m as Ee,n as Te,o as Le,s as ye,p as ve,c as C,B as M}from"./index-jJ-r5mz2.js";import{u as Ae,C as De}from"./confirm-dialog-Br2qhugx.js";import{c as _}from"./index-DSZ_lwlW.js";import{S as Be,D as Oe}from"./server-C90NfND0.js";import{T as $e}from"./trash-2-XLUJNpTV.js";import{B as ie}from"./badge-B4wrcvZ9.js";import{C as oe}from"./circle-alert-CnzQp5Ap.js";import{u as qe,a as Fe,o as Ie,F as Pe,b as P,c as H,d as G,e as K,f as U,s as ne,n as He}from"./form-BnuX5DB7.js";import{b as Ge,d as Ke,e as Ue,f as Qe,h as Xe}from"./index-ZV2pxxac.js";import{I as Ye}from"./input-DJh99Cqt.js";import{S as Je,a as Ve,b as Ze,c as et,d as ae}from"./select-Da-KtjNO.js";import"./index-DC18PyZR.js";import"./index-CT9bT4NP.js";import"./index-Bdu6MxlU.js";import"./index-BkDHe_rU.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Q=_("circle-check",tt);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],rt=_("circle-pause",st);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ot=_("circle-plus",it);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]],le=_("cog",nt);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],lt=_("cpu",at);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z",key:"p1xzt8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]],dt=_("messages-square",ct);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],pt=_("sparkles",ht);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],ce=_("terminal",ut);var g=function(){return g=Object.assign||function(e){for(var o,t=1,s=arguments.length;t<s;t++){o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},g.apply(this,arguments)},de={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},he={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},D={width:"20px",height:"20px",position:"absolute",zIndex:1},ft={top:g(g({},de),{top:"-5px"}),right:g(g({},he),{left:void 0,right:"-5px"}),bottom:g(g({},de),{top:void 0,bottom:"-5px"}),left:g(g({},he),{left:"-5px"}),topRight:g(g({},D),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:g(g({},D),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:g(g({},D),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:g(g({},D),{left:"-10px",top:"-10px",cursor:"nw-resize"})},gt=v.memo(function(e){var o=e.onResizeStart,t=e.direction,s=e.children,i=e.replaceStyles,a=e.className,l=v.useCallback(function(c){o(c,t)},[o,t]),n=v.useCallback(function(c){o(c,t)},[o,t]),d=v.useMemo(function(){return g(g({position:"absolute",userSelect:"none"},ft[t]),i??{})},[i,t]);return r.jsx("div",{className:a||void 0,style:d,onMouseDown:l,onTouchStart:n,children:s})}),mt=function(){var e=function(o,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a])},e(o,t)};return function(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(o,t);function s(){this.constructor=o}o.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}}(),z=function(){return z=Object.assign||function(e){for(var o,t=1,s=arguments.length;t<s;t++){o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},z.apply(this,arguments)},xt={width:"auto",height:"auto"},B=function(e,o,t){return Math.max(Math.min(e,t),o)},pe=function(e,o,t){var s=Math.round(e/o);return s*o+t*(s-1)},R=function(e,o){return new RegExp(e,"i").test(o)},O=function(e){return!!(e.touches&&e.touches.length)},yt=function(e){return!!((e.clientX||e.clientX===0)&&(e.clientY||e.clientY===0))},ue=function(e,o,t){t===void 0&&(t=0);var s=o.reduce(function(a,l,n){return Math.abs(l-e)<Math.abs(o[a]-e)?n:a},0),i=Math.abs(o[s]-e);return t===0||i<t?o[s]:e},X=function(e){return e=e.toString(),e==="auto"||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:"".concat(e,"px")},$=function(e,o,t,s){if(e&&typeof e=="string"){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%")){var i=Number(e.replace("%",""))/100;return o*i}if(e.endsWith("vw")){var i=Number(e.replace("vw",""))/100;return t*i}if(e.endsWith("vh")){var i=Number(e.replace("vh",""))/100;return s*i}}return e},vt=function(e,o,t,s,i,a,l){return s=$(s,e.width,o,t),i=$(i,e.height,o,t),a=$(a,e.width,o,t),l=$(l,e.height,o,t),{maxWidth:typeof s>"u"?void 0:Number(s),maxHeight:typeof i>"u"?void 0:Number(i),minWidth:typeof a>"u"?void 0:Number(a),minHeight:typeof l>"u"?void 0:Number(l)}},wt=function(e){return Array.isArray(e)?e:[e,e]},bt=["as","ref","style","className","grid","gridGap","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],fe="__resizable_base__",jt=function(e){mt(o,e);function o(t){var s,i,a,l,n=e.call(this,t)||this;return n.ratio=1,n.resizable=null,n.parentLeft=0,n.parentTop=0,n.resizableLeft=0,n.resizableRight=0,n.resizableTop=0,n.resizableBottom=0,n.targetLeft=0,n.targetTop=0,n.delta={width:0,height:0},n.appendBase=function(){if(!n.resizable||!n.window)return null;var d=n.parentNode;if(!d)return null;var c=n.window.document.createElement("div");return c.style.width="100%",c.style.height="100%",c.style.position="absolute",c.style.transform="scale(0, 0)",c.style.left="0",c.style.flex="0 0 100%",c.classList?c.classList.add(fe):c.className+=fe,d.appendChild(c),c},n.removeBase=function(d){var c=n.parentNode;c&&c.removeChild(d)},n.state={isResizing:!1,width:(i=(s=n.propsSize)===null||s===void 0?void 0:s.width)!==null&&i!==void 0?i:"auto",height:(l=(a=n.propsSize)===null||a===void 0?void 0:a.height)!==null&&l!==void 0?l:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},n.onResizeStart=n.onResizeStart.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n}return Object.defineProperty(o.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||xt},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){var t=0,s=0;if(this.resizable&&this.window){var i=this.resizable.offsetWidth,a=this.resizable.offsetHeight,l=this.resizable.style.position;l!=="relative"&&(this.resizable.style.position="relative"),t=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:i,s=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:a,this.resizable.style.position=l}return{width:t,height:s}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sizeStyle",{get:function(){var t=this,s=this.props.size,i=function(n){var d;if(typeof t.state[n]>"u"||t.state[n]==="auto")return"auto";if(t.propsSize&&t.propsSize[n]&&(!((d=t.propsSize[n])===null||d===void 0)&&d.toString().endsWith("%"))){if(t.state[n].toString().endsWith("%"))return t.state[n].toString();var c=t.getParentSize(),p=Number(t.state[n].toString().replace("px","")),h=p/c[n]*100;return"".concat(h,"%")}return X(t.state[n])},a=s&&typeof s.width<"u"&&!this.state.isResizing?X(s.width):i("width"),l=s&&typeof s.height<"u"&&!this.state.isResizing?X(s.height):i("height");return{width:a,height:l}},enumerable:!1,configurable:!0}),o.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var t=this.appendBase();if(!t)return{width:0,height:0};var s=!1,i=this.parentNode.style.flexWrap;i!=="wrap"&&(s=!0,this.parentNode.style.flexWrap="wrap"),t.style.position="relative",t.style.minWidth="100%",t.style.minHeight="100%";var a={width:t.offsetWidth,height:t.offsetHeight};return s&&(this.parentNode.style.flexWrap=i),this.removeBase(t),a},o.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},o.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},o.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var t=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:t.flexBasis!=="auto"?t.flexBasis:void 0})}},o.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},o.prototype.createSizeForCssProperty=function(t,s){var i=this.propsSize&&this.propsSize[s];return this.state[s]==="auto"&&this.state.original[s]===t&&(typeof i>"u"||i==="auto")?"auto":t},o.prototype.calculateNewMaxFromBoundary=function(t,s){var i=this.props.boundsByDirection,a=this.state.direction,l=i&&R("left",a),n=i&&R("top",a),d,c;if(this.props.bounds==="parent"){var p=this.parentNode;p&&(d=l?this.resizableRight-this.parentLeft:p.offsetWidth+(this.parentLeft-this.resizableLeft),c=n?this.resizableBottom-this.parentTop:p.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(d=l?this.resizableRight:this.window.innerWidth-this.resizableLeft,c=n?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(d=l?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),c=n?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return d&&Number.isFinite(d)&&(t=t&&t<d?t:d),c&&Number.isFinite(c)&&(s=s&&s<c?s:c),{maxWidth:t,maxHeight:s}},o.prototype.calculateNewSizeFromDirection=function(t,s){var i=this.props.scale||1,a=wt(this.props.resizeRatio||1),l=a[0],n=a[1],d=this.state,c=d.direction,p=d.original,h=this.props,f=h.lockAspectRatio,w=h.lockAspectRatioExtraHeight,m=h.lockAspectRatioExtraWidth,u=p.width,b=p.height,S=w||0,k=m||0;return R("right",c)&&(u=p.width+(t-p.x)*l/i,f&&(b=(u-k)/this.ratio+S)),R("left",c)&&(u=p.width-(t-p.x)*l/i,f&&(b=(u-k)/this.ratio+S)),R("bottom",c)&&(b=p.height+(s-p.y)*n/i,f&&(u=(b-S)*this.ratio+k)),R("top",c)&&(b=p.height-(s-p.y)*n/i,f&&(u=(b-S)*this.ratio+k)),{newWidth:u,newHeight:b}},o.prototype.calculateNewSizeFromAspectRatio=function(t,s,i,a){var l=this.props,n=l.lockAspectRatio,d=l.lockAspectRatioExtraHeight,c=l.lockAspectRatioExtraWidth,p=typeof a.width>"u"?10:a.width,h=typeof i.width>"u"||i.width<0?t:i.width,f=typeof a.height>"u"?10:a.height,w=typeof i.height>"u"||i.height<0?s:i.height,m=d||0,u=c||0;if(n){var b=(f-m)*this.ratio+u,S=(w-m)*this.ratio+u,k=(p-u)/this.ratio+m,x=(h-u)/this.ratio+m,y=Math.max(p,b),E=Math.min(h,S),T=Math.max(f,k),L=Math.min(w,x);t=B(t,y,E),s=B(s,T,L)}else t=B(t,p,h),s=B(s,f,w);return{newWidth:t,newHeight:s}},o.prototype.setBoundingClientRect=function(){var t=1/(this.props.scale||1);if(this.props.bounds==="parent"){var s=this.parentNode;if(s){var i=s.getBoundingClientRect();this.parentLeft=i.left*t,this.parentTop=i.top*t}}if(this.props.bounds&&typeof this.props.bounds!="string"){var a=this.props.bounds.getBoundingClientRect();this.targetLeft=a.left*t,this.targetTop=a.top*t}if(this.resizable){var l=this.resizable.getBoundingClientRect(),n=l.left,d=l.top,c=l.right,p=l.bottom;this.resizableLeft=n*t,this.resizableRight=c*t,this.resizableTop=d*t,this.resizableBottom=p*t}},o.prototype.onResizeStart=function(t,s){if(!(!this.resizable||!this.window)){var i=0,a=0;if(t.nativeEvent&&yt(t.nativeEvent)?(i=t.nativeEvent.clientX,a=t.nativeEvent.clientY):t.nativeEvent&&O(t.nativeEvent)&&(i=t.nativeEvent.touches[0].clientX,a=t.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var l=this.props.onResizeStart(t,s,this.resizable);if(l===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var n,d=this.window.getComputedStyle(this.resizable);if(d.flexBasis!=="auto"){var c=this.parentNode;if(c){var p=this.window.getComputedStyle(c).flexDirection;this.flexDir=p.startsWith("row")?"row":"column",n=d.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var h={original:{x:i,y:a,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:z(z({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(t.target).cursor||"auto"}),direction:s,flexBasis:n};this.setState(h)}},o.prototype.onMouseMove=function(t){var s=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&O(t))try{t.preventDefault(),t.stopPropagation()}catch{}var i=this.props,a=i.maxWidth,l=i.maxHeight,n=i.minWidth,d=i.minHeight,c=O(t)?t.touches[0].clientX:t.clientX,p=O(t)?t.touches[0].clientY:t.clientY,h=this.state,f=h.direction,w=h.original,m=h.width,u=h.height,b=this.getParentSize(),S=vt(b,this.window.innerWidth,this.window.innerHeight,a,l,n,d);a=S.maxWidth,l=S.maxHeight,n=S.minWidth,d=S.minHeight;var k=this.calculateNewSizeFromDirection(c,p),x=k.newHeight,y=k.newWidth,E=this.calculateNewMaxFromBoundary(a,l);this.props.snap&&this.props.snap.x&&(y=ue(y,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(x=ue(x,this.props.snap.y,this.props.snapGap));var T=this.calculateNewSizeFromAspectRatio(y,x,{width:E.maxWidth,height:E.maxHeight},{width:n,height:d});if(y=T.newWidth,x=T.newHeight,this.props.grid){var L=pe(y,this.props.grid[0],this.props.gridGap?this.props.gridGap[0]:0),te=pe(x,this.props.grid[1],this.props.gridGap?this.props.gridGap[1]:0),A=this.props.snapGap||0,ke=A===0||Math.abs(L-y)<=A?L:y,Ne=A===0||Math.abs(te-x)<=A?te:x;y=ke,x=Ne}var se={width:y-w.width,height:x-w.height};if(this.delta=se,m&&typeof m=="string"){if(m.endsWith("%")){var q=y/b.width*100;y="".concat(q,"%")}else if(m.endsWith("vw")){var F=y/this.window.innerWidth*100;y="".concat(F,"vw")}else if(m.endsWith("vh")){var I=y/this.window.innerHeight*100;y="".concat(I,"vh")}}if(u&&typeof u=="string"){if(u.endsWith("%")){var q=x/b.height*100;x="".concat(q,"%")}else if(u.endsWith("vw")){var F=x/this.window.innerWidth*100;x="".concat(F,"vw")}else if(u.endsWith("vh")){var I=x/this.window.innerHeight*100;x="".concat(I,"vh")}}var N={width:this.createSizeForCssProperty(y,"width"),height:this.createSizeForCssProperty(x,"height")};this.flexDir==="row"?N.flexBasis=N.width:this.flexDir==="column"&&(N.flexBasis=N.height);var _e=this.state.width!==N.width,Re=this.state.height!==N.height,We=this.state.flexBasis!==N.flexBasis,re=_e||Re||We;re&&Ce.flushSync(function(){s.setState(N)}),this.props.onResize&&re&&this.props.onResize(t,f,this.resizable,se)}},o.prototype.onMouseUp=function(t){var s,i,a=this.state,l=a.isResizing,n=a.direction;a.original,!(!l||!this.resizable)&&(this.props.onResizeStop&&this.props.onResizeStop(t,n,this.resizable,this.delta),this.props.size&&this.setState({width:(s=this.props.size.width)!==null&&s!==void 0?s:"auto",height:(i=this.props.size.height)!==null&&i!==void 0?i:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:z(z({},this.state.backgroundStyle),{cursor:"auto"})}))},o.prototype.updateSize=function(t){var s,i;this.setState({width:(s=t.width)!==null&&s!==void 0?s:"auto",height:(i=t.height)!==null&&i!==void 0?i:"auto"})},o.prototype.renderResizer=function(){var t=this,s=this.props,i=s.enable,a=s.handleStyles,l=s.handleClasses,n=s.handleWrapperStyle,d=s.handleWrapperClass,c=s.handleComponent;if(!i)return null;var p=Object.keys(i).map(function(h){return i[h]!==!1?r.jsx(gt,{direction:h,onResizeStart:t.onResizeStart,replaceStyles:a&&a[h],className:l&&l[h],children:c&&c[h]?c[h]:null},h):null});return r.jsx("div",{className:d,style:n,children:p})},o.prototype.render=function(){var t=this,s=Object.keys(this.props).reduce(function(l,n){return bt.indexOf(n)!==-1||(l[n]=t.props[n]),l},{}),i=z(z(z({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(i.flexBasis=this.state.flexBasis);var a=this.props.as||"div";return r.jsxs(a,z({style:i,className:this.props.className},s,{ref:function(l){l&&(t.resizable=l)},children:[this.state.isResizing&&r.jsx("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer()]}))},o.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],gridGap:[0,0],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},o}(v.PureComponent);const we=me.createContext(null);function St({children:e}){const[o,t]=Ae(null),[s,i]=v.useState(null);return r.jsx(we.Provider,{value:{open:o,setOpen:t,currentRow:s,setCurrentRow:i},children:e})}const V=()=>{const e=me.useContext(we);if(!e)throw new Error("useTargetDialog has to be used within <TargetDialogContext>");return e},be=Me.create({baseURL:"/compose",timeout:1e4,headers:{"Content-Type":"application/json"}});be.interceptors.response.use(e=>e.data,e=>Promise.reject(e));const Z=e=>be({...e}),zt=e=>Z({url:"/api/workspaces",method:"GET",signal:e}),je=()=>["/api/workspaces"],kt=e=>{const{query:o}=e??{};return{queryKey:o?.queryKey??je(),queryFn:({signal:i})=>zt(i),...o}};function Nt(e,o){const t=kt(e),s=xe(t);return s.queryKey=t.queryKey,s}const _t=(e,o)=>Z({url:`/api/workspaces/${e}`,method:"GET",signal:o}),Se=e=>[`/api/workspaces/${e}`],Rt=(e,o)=>{const{query:t}=o??{};return{queryKey:t?.queryKey??Se(e),queryFn:({signal:a})=>_t(e,a),enabled:!!e,...t}};function Wt(e,o,t){const s=Rt(e,o),i=xe(s);return i.queryKey=s.queryKey,i}const Ct=e=>Z({url:`/api/workspaces/${e}`,method:"DELETE"}),Mt=e=>{const o=["deleteWorkspaceApiWorkspacesNameDelete"],{mutation:t}=e?e.mutation&&"mutationKey"in e.mutation&&e.mutation.mutationKey?e:{...e,mutation:{...e.mutation,mutationKey:o}}:{mutation:{mutationKey:o}};return{mutationFn:i=>{const{name:a}=i??{};return Ct(a)},...t}},Et=(e,o)=>{const t=Mt(e);return Ee(t)},ze="/compose";let j=null;const Y=new Set,Tt=e=>(Y.add(e),()=>Y.delete(e)),W=e=>{for(const o of Y)o(e)},Lt=async e=>{const o=new TextDecoder("utf-8");let t="";try{for(;;){const{done:s,value:i}=await e.read();if(s){W({type:"__end__",data:{}});break}for(t+=o.decode(i,{stream:!0});;){const a=t.indexOf(`

`);if(a===-1)break;const l=t.slice(0,a);t=t.slice(a+2);const n=l.split(`
`).find(d=>d.startsWith("data:"));if(n){const d=n.substring(5).trim();try{const c=JSON.parse(d);W(c)}catch(c){console.error("Invalid SSE JSON:",d,c),W({type:"agent_error",data:{error:"Invalid SSE JSON received",details:d}})}}}}}catch(s){if(j?.signal.aborted)W({type:"__end__",data:{}});else{console.error("Stream processing error:",s);const i=s instanceof Error?s.message:String(s);W({type:"agent_error",data:{error:"Stream processing error",details:i}})}}finally{j=null}},At=async e=>{j&&j.abort(),j=new AbortController;const o=`${ze}/api/stream`;try{const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(e),signal:j.signal});if(!t.ok||!t.body){const i=await t.text();throw new Error(`HTTP Error: ${t.status} ${t.statusText}
${i}`)}const s=t.body.getReader();await Lt(s)}catch(t){if(j?.signal.aborted)console.log("Stream aborted by user.");else{console.log("Failed to connect to stream:",t);const s=t instanceof Error?t.message:String(t);W({type:"agent_error",data:{error:"Failed to connect",details:s}})}j=null}},Dt=()=>{j&&(j.abort(),j=null)},J=Te(e=>({logs:[],isConnected:!!j,actions:{startStream:o=>{e({isConnected:!0,logs:[]}),At(o)},stopStream:()=>{Dt(),e({isConnected:!1,logs:[]})},clearLogs:()=>e({logs:[]})}}));Tt(e=>{J.setState(o=>e.type==="agent_start"?{isConnected:!0,logs:[e]}:e.type==="__end__"||e.type==="agent_error"?{isConnected:!1,logs:[...o.logs,e]}:{logs:[...o.logs,e]})});const ee=()=>{const{logs:e,isConnected:o,actions:t}=J(s=>s);return v.useEffect(()=>()=>{J.getState().isConnected||t.clearLogs()},[t]),{...t,logs:e,isConnected:o}},Bt=()=>{const{data:e,...o}=Nt({query:{select:t=>t?.data?.items??null}});return{workspaces:e,...o}},Ot=e=>{const o=Le(),t=!!e,{data:s,...i}=Wt(e,{query:{enabled:t,select:n=>n?.data??null}}),a=()=>{e&&(o.invalidateQueries({queryKey:je()}),o.invalidateQueries({queryKey:Se(e)}))},l=Et({mutation:{onSuccess:()=>{ve(`靶机 "${e}" 删除成功.`),a()},onError:n=>{ye(`删除靶机 "${e}" 失败.`,n.detail)}}});return t?{workspace:s,workspaceQuery:i,deleteWorkspace:l.mutate,deleteWorkspaceAsync:l.mutateAsync,isDeleting:l.isPending}:{workspace:null,workspaceQuery:{isInitialLoading:!1},deleteWorkspace:()=>{},deleteWorkspaceAsync:async()=>Promise.resolve(new Response),isDeleting:!1}},$t=e=>{const[o,t]=v.useState(!1),[s,i]=v.useState(null);return{download:v.useCallback(async()=>{if(!e)return;t(!0),i(null);const l=`${ze}/api/workspaces/${e}/download`;try{const n=await fetch(l,{method:"GET"});if(!n.ok)throw await n.json();const d=n.headers.get("content-disposition");let c=`${e}.zip`;if(d){const w=d.match(/filename=(?:"([^"]+)"|([^;]+))/);if(w){const m=(w[1]||w[2]||"").trim();m&&(c=m)}}const p=await n.blob(),h=window.URL.createObjectURL(p),f=document.createElement("a");f.href=h,f.download=c,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(h),f.remove()}catch(n){const d=n;i(d),ye(`Failed to download workspace "${e}".`,d.detail)}finally{t(!1)}},[e]),isDownloading:o,error:s}};function qt({className:e,onSelectTarget:o,selectedTarget:t}){const{workspaces:s,isLoading:i}=Bt(),{isConnected:a}=ee(),{setOpen:l}=V();return r.jsxs("div",{className:C("bg-background-inset h-full rounded-lg border p-4",e),children:[r.jsxs("div",{className:"mb-4 flex flex-col items-start justify-between",children:[r.jsxs("div",{className:"flex w-full justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"靶机仓库"}),r.jsxs(M,{size:"sm",onClick:()=>l("create"),disabled:a,children:["创建靶机",r.jsx(ot,{size:16,className:"mr-2"})]})]}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:["当前SSE连接状态: ",a?"已连接":"未连接"]}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"处于性能考虑，日志将不会被持久化存储"})]}),r.jsx("div",{className:"no-scrollbar h-[calc(100%-52px)] overflow-auto mb-4 flex flex-col justify-between",children:i?r.jsx("p",{className:"text-muted-foreground",children:"加载中..."}):s&&s.length>0?r.jsx("ul",{children:s.map(n=>r.jsx(Ft,{name:n,isSelected:t===n,onSelect:o},n))}):r.jsx("div",{className:"flex h-full items-center justify-center text-center",children:r.jsxs("p",{className:"text-muted-foreground",children:["没有可用的靶机. ",r.jsx("br",{}),"请点击上方按钮创建一个。"]})})})]})}function Ft({name:e,isSelected:o,onSelect:t}){const{setOpen:s,setCurrentRow:i}=V(),{download:a}=$t(e),l=()=>{a().then(()=>{ve(`动态靶机 "${e}" 正在下载，请稍等.`)})};return r.jsxs("li",{className:C("group hover:bg-muted/50 flex cursor-pointer items-center justify-between rounded-md p-2",o&&"bg-muted"),onClick:()=>t(e),children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Be,{className:C("mr-3 size-5",o?"text-primary":"text-muted-foreground")}),r.jsx("span",{className:"font-medium",children:e})]}),r.jsxs("div",{className:"hidden items-center group-hover:flex",children:[r.jsx(M,{variant:"ghost",size:"icon",className:"size-7",onClick:n=>{n.stopPropagation(),i(e),l()},children:r.jsx(Oe,{size:14})}),r.jsx(M,{variant:"ghost",size:"icon",className:"size-7 text-red-500 hover:text-red-600",onClick:()=>{i(e),s("delete")},children:r.jsx($e,{size:14})})]})]})}const ge=({data:e})=>e==null?r.jsx("span",{className:"text-muted-foreground",children:"(null)"}):typeof e!="object"?r.jsx("pre",{className:"whitespace-pre-wrap font-mono",children:String(e)}):Object.keys(e).length===0?r.jsx("em",{className:"text-muted-foreground",children:"(empty)"}):r.jsx("div",{className:"font-mono text-xs bg-muted/50 p-2 rounded",children:r.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(e,null,2)})});function It(e){switch(e.type){case"agent_start":return{Icon:lt,color:"border-green-500",title:"会话开始",content:r.jsxs("div",{className:"space-y-1",children:[r.jsxs("p",{children:[r.jsx(ie,{variant:"outline",children:"Session"}),r.jsx("code",{className:"ml-2",children:e.data.session})]}),r.jsxs("p",{children:[r.jsx(ie,{variant:"outline",children:"Description"}),r.jsx("span",{className:"ml-2",children:e.data.description})]})]})};case"agent_finish":return{Icon:Q,color:"border-green-500",title:"会话完成",content:r.jsxs("details",{open:!0,children:[r.jsxs("summary",{className:"cursor-pointer",children:["工作区：",r.jsx("strong",{children:e.data.result.name})]}),r.jsx("pre",{className:"mt-2 p-2 bg-muted/50 rounded whitespace-pre-wrap font-mono text-xs",children:e.data.result.readme})]})};case"agent_error":return{Icon:oe,color:"border-red-500",title:"错误",content:r.jsxs("div",{className:"text-red-600 dark:text-red-400",children:[r.jsx("strong",{children:e.data.error}),e.data.details&&r.jsxs("details",{children:[r.jsx("summary",{className:"cursor-pointer",children:"详情"}),r.jsx("pre",{className:"mt-2 whitespace-pre-wrap text-xs",children:e.data.details})]})]})};case"think":return{Icon:pt,color:"border-yellow-500",title:`思考 (Step ${e.step})`,content:r.jsx("p",{className:"italic text-yellow-600 dark:text-yellow-400",children:e.content})};case"chat":return{Icon:dt,color:"border-blue-500",title:`对话 (Step ${e.step})`,content:r.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:e.content})};case"tool_prep":return{Icon:le,color:"border-purple-500",title:`准备工具 (Step ${e.data.step}, #${e.data.index})`,content:r.jsxs("p",{children:["工具：",r.jsx("strong",{children:e.data.name})]})};case"tool_args":return{Icon:le,color:"border-purple-500",title:`工具参数 (Step ${e.step}, #${e.index})`,content:r.jsx("p",{className:"text-muted-foreground font-mono text-xs",children:e.content})};case"tool_call":return{Icon:ce,color:"border-purple-500",title:`调用工具 (Step ${e.data.step})`,content:r.jsxs("div",{children:[r.jsxs("p",{children:["工具：",r.jsx("strong",{children:e.data.name})]}),r.jsxs("details",{className:"mt-1",children:[r.jsx("summary",{className:"cursor-pointer",children:"参数"}),r.jsx(ge,{data:e.data.arguments})]})]})};case"tool_result":return{Icon:ce,color:"border-purple-500",title:`工具输出 (Step ${e.data.step})`,content:r.jsx(ge,{data:(typeof e.data.output=="string"||e.data.output===null,e.data.output)})};case"token_usage":return{Icon:Q,color:"border-green-400",title:`Token 统计 (Step ${e.data.step})`,content:r.jsxs("div",{className:"flex gap-4 text-xs",children:[r.jsxs("span",{children:["Prompt: ",r.jsx("strong",{children:e.data.usage.prompt})]}),r.jsxs("span",{children:["Completion: ",r.jsx("strong",{children:e.data.usage.completion})]}),r.jsxs("span",{children:["Total: ",r.jsx("strong",{children:e.data.usage.total})]})]})};case"__end__":return{Icon:Q,color:"border-gray-500",title:"结束",content:r.jsx("p",{className:"text-muted-foreground",children:"流已结束"})};default:return{Icon:oe,color:"border-gray-400",title:"未知事件",content:r.jsx("pre",{className:"text-xs",children:JSON.stringify(e,null,2)})}}}const Pt=({item:e})=>{const{Icon:o,color:t,title:s,content:i}=It(e),a=new Date().toLocaleTimeString();return r.jsxs("div",{className:C("p-3 rounded-lg border-l-4 bg-card shadow-sm",t),children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(o,{className:"h-5 w-5"}),r.jsx("span",{className:"font-semibold text-sm",children:s}),r.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:a})]}),r.jsx("div",{className:"pl-8 text-sm",children:i})]})},Ht=()=>{const{logs:e,stopStream:o,isConnected:t}=ee(),s=v.useRef(null),[i,a]=v.useState(!0),l=v.useRef(null),n=v.useMemo(()=>{const c=[],p=new Map;for(const h of e)if(h.type==="think_stream"||h.type==="chat_stream"||h.type==="tool_args_stream"){const f=h.type==="tool_args_stream",w=f?"tool_args":h.type.split("_")[0],m=`${w}-${h.data.step}${f?`-${h.data.index}`:""}`;let u=p.get(m);u?u.content+=h.data.chunk:(u={id:m,type:w,step:h.data.step,index:f?h.data.index:void 0,content:h.data.chunk},p.set(m,u),c.push(u))}else c.push(h);return c},[e]),d=v.useCallback(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[]);return v.useEffect(()=>{i&&d()},[n,i,d]),v.useEffect(()=>{const c=s.current;if(!c)return;const p=()=>{l.current&&window.clearTimeout(l.current),c.scrollHeight-c.scrollTop-c.clientHeight<10?a(!0):(a(!1),l.current=window.setTimeout(()=>{a(!0)},5e3))};return c.addEventListener("scroll",p,{passive:!0}),()=>{c.removeEventListener("scroll",p),l.current&&window.clearTimeout(l.current)}},[d]),r.jsxs("div",{className:"relative h-full w-full",children:[r.jsxs("div",{ref:s,className:"h-full w-full overflow-y-auto p-4 space-y-4 bg-background",children:[n.map((c,p)=>{const h="id"in c?c.id:`${p}-${c.type}`;return r.jsx(Pt,{item:c},h)}),e.length===0&&r.jsx("div",{className:"flex h-full items-center justify-center",children:r.jsx("p",{className:"text-muted-foreground",children:"等待接收事件日志..."})})]}),t&&r.jsx("div",{className:"absolute bottom-4 right-4",children:r.jsx(M,{variant:"destructive",size:"icon",onClick:o,className:"rounded-full shadow-lg hover:bg-destructive/10 hover:text-destructive",children:r.jsx(rt,{className:"h-6 w-6"})})})]})};function Gt({className:e,...o}){return r.jsx("textarea",{"data-slot":"textarea",className:C("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...o})}const Kt=Ie({model:ne().min(1,"模型必填"),max_steps:He().min(1,"最大步数必填,且必须为数字"),description:ne().min(1,"描述必填")});function Ut({open:e,onOpenChange:o}){const{startStream:t}=ee(),s=qe({resolver:Fe(Kt),defaultValues:{model:"",max_steps:40,description:""}}),i=a=>{t({description:a.description,model:a.model,max_steps:a.max_steps}),s.reset(),o(!1)};return r.jsx(Ge,{open:e,onOpenChange:o,children:r.jsxs(Ke,{className:"overflow-hidden",children:[r.jsx(Ue,{children:r.jsx(Qe,{children:"创建动态靶机"})}),r.jsx(Pe,{...s,children:r.jsxs("form",{id:"targets-form",onSubmit:s.handleSubmit(i),className:"min-h-0 space-y-5 overflow-y-auto px-4",children:[r.jsx(P,{control:s.control,name:"model",render:({field:a})=>r.jsxs(H,{className:"space-y-1",children:[r.jsx(G,{children:"模型选择"}),r.jsx(K,{children:r.jsxs(Je,{onValueChange:a.onChange,value:a.value,children:[r.jsx(Ve,{children:r.jsx(Ze,{placeholder:"请选择模型类别"})}),r.jsxs(et,{children:[r.jsx(ae,{value:"deepseek-reasoner",children:"deepseek-reasoner"}),r.jsx(ae,{value:"deepseek-chat",children:"deepseek-chat"}),r.jsxs("div",{className:"text-muted-foreground p-2 text-xs",children:[r.jsx("p",{children:"reasoner模型大约需要10分钟，但靶机生成成功率较高"}),r.jsx("p",{children:"chat模型大约需要3分钟，但靶机生成成功率较低"})]})]})]})}),r.jsx(U,{})]})}),r.jsx(P,{control:s.control,name:"max_steps",render:({field:a})=>r.jsxs(H,{className:"space-y-1",children:[r.jsx(G,{children:"最大步数"}),r.jsx(K,{children:r.jsx(Ye,{placeholder:"请输入最大步数",type:"number",value:a.value,onChange:l=>a.onChange(Number(l.target.value))})}),r.jsx(U,{})]})}),r.jsx(P,{control:s.control,name:"description",render:({field:a})=>r.jsxs(H,{className:"space-y-1",children:[r.jsx(G,{children:"描述"}),r.jsx(K,{children:r.jsx(Gt,{...a,placeholder:"请输入描述",className:"h-40"})}),r.jsx(U,{})]})})]})}),r.jsx(Xe,{children:r.jsx(M,{type:"submit",form:"targets-form",children:"创建"})})]})})}function Qt(){const{open:e,setOpen:o,currentRow:t,setCurrentRow:s}=V(),{deleteWorkspaceAsync:i}=Ot(t);return r.jsxs(r.Fragment,{children:[r.jsx(Ut,{open:e==="create",onOpenChange:()=>{o("create"),setTimeout(()=>{s(null)},500)}},"target-create-dialog"),t&&r.jsx(r.Fragment,{children:r.jsx(De,{destructive:!0,open:e==="delete",onOpenChange:()=>{o("delete")},handleConfirm:()=>{o(null),setTimeout(()=>{s(null)},500),i({name:t})},className:"max-w-md",title:`删除动态靶机: ${t} ?`,desc:r.jsxs(r.Fragment,{children:["你确定要删除动态靶机: ",r.jsx("strong",{children:t})," ?",r.jsx("br",{}),"此操作无法撤销."]}),confirmText:"删除"},"target-delete")})]})}function Xt(){const[e,o]=v.useState(null);return r.jsxs(St,{children:[r.jsxs("div",{className:"flex h-full w-full flex-row gap-4 p-4",children:[r.jsx(jt,{defaultSize:{width:400,height:"100%"},minWidth:300,maxWidth:600,enable:{top:!1,right:!0,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},className:"flex-none",children:r.jsx(qt,{onSelectTarget:o,selectedTarget:e,className:"h-full"})}),r.jsx("div",{className:"min-w-0 flex-1",children:r.jsx(Ht,{})})]}),r.jsx(Qt,{})]})}const ps=Xt;export{ps as component};
