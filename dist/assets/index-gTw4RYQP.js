import{j as e,c as k,B as L,b as B,r as m}from"./index-jJ-r5mz2.js";import{I as H}from"./input-DJh99Cqt.js";import{S as w,a as y,b as T,c as I,d as g}from"./select-Da-KtjNO.js";import{S as V}from"./separator-CUn7s6rW.js";import{H as F,S as E,T as M,P as O,M as U}from"./theme-switch-Co7n-EGK.js";import{I as p,C as N,L as R,u as W}from"./use-log-Bf_Sl--R.js";import{T as f}from"./trash-2-XLUJNpTV.js";import{P as S}from"./play-m6jg8ltQ.js";import{C as A}from"./circle-CW_Z5uWT.js";import{C as _,H as $,a as X,B as q,I as G,b as z,c as J,d as K,e as Q,f as Y}from"./loading-button-Dxj-K1-v.js";import{C as Z,b as ee,c as se,a as ae,e as te}from"./card-BJCnjeSF.js";import{u as D,S as ie,a as ne,b as le}from"./scenario-file-dialogs-DxajuG-N.js";import{a as P,u as re}from"./use-scenario-CWX--LNn.js";import"./index-CT9bT4NP.js";import"./index-DSZ_lwlW.js";import"./index-DC18PyZR.js";import"./index-Bdu6MxlU.js";import"./index-ZV2pxxac.js";import"./index-BkDHe_rU.js";import"./avatar-CVUMpbYi.js";import"./createReactComponent-DA_aFz5i.js";import"./index-DcoZsgCb.js";import"./search-context-Dy6rVJYC.js";import"./command-BAzBGs10.js";import"./search-C8RdyhLB.js";import"./circle-alert-CnzQp5Ap.js";import"./confirm-dialog-Br2qhugx.js";import"./form-BnuX5DB7.js";import"./IconTrash-CRDPUBDJ.js";const b={running:{label:"运行中",icon:X,iconClassName:"text-green-500",actions:[{label:"进入场景",icon:S,variant:"default",actionType:"enter"},{label:"停止",icon:_,variant:"destructive",actionType:"stop"}]},stopped:{label:"已停止",icon:A,iconClassName:"text-gray-500",actions:[{label:"启动",icon:S,actionType:"start"},{label:"详细信息",icon:p,variant:"outline",actionType:"view_details"},{label:"删除",icon:f,variant:"destructive",actionType:"delete"}]},error:{label:"错误",icon:N,iconClassName:"text-red-500",actions:[{label:"详细信息",icon:p,variant:"outline",actionType:"view_details"},{label:"删除",icon:f,variant:"destructive",actionType:"delete"}]},building:{label:"构建中",icon:$,iconClassName:"text-blue-500",actions:[{label:"停止构建",icon:_,variant:"outline",actionType:"force_stop_build"}]},pending:{label:"待处理",icon:A,iconClassName:"text-yellow-500",actions:[{label:"构建",icon:S,variant:"secondary",actionType:"build"},{label:"详细信息",icon:p,variant:"outline",actionType:"view_details"},{label:"删除",icon:f,variant:"destructive",actionType:"delete"}]},build_error:{label:"构建错误",icon:N,iconClassName:"text-red-500",actions:[{label:"详细信息",icon:p,variant:"outline",actionType:"view_details"},{label:"删除",icon:f,variant:"destructive",actionType:"delete"}]},runtime_error:{label:"运行错误",icon:N,iconClassName:"text-red-500",actions:[{label:"详细信息",icon:p,variant:"outline",actionType:"view_details"},{label:"删除",icon:f,variant:"destructive",actionType:"delete"}]}};function oe({state:s}){const i=b[s],n=i.icon;return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border px-2.5 py-0.5 text-xs font-semibold whitespace-nowrap",children:[e.jsx(n,{className:k("h-3 w-3",i.iconClassName)}),i.label]})}function ce({state:s,onAction:i,pendingAction:n}){const a=b[s];if(a.component){const t=a.component;return e.jsx(t,{})}return a.actions?e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.actions.map(t=>{const r=t.icon;return e.jsxs(q,{variant:t.variant||"default",size:"sm",isLoading:n===t.actionType,onClick:()=>i(t.actionType),children:[e.jsx(r,{className:"mr-2 h-4 w-4"}),t.label]},t.label)})}):e.jsx("div",{className:"min-h-[36px]"})}function de({name:s,description:i,state:n,onAction:a,pendingAction:t,uuid:r}){return e.jsxs(Z,{className:"h-full flex flex-col",children:[e.jsx(ee,{className:"",children:e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx(se,{className:"truncate max-w-[50%]",title:s,children:s}),e.jsx(oe,{state:n})]})}),e.jsxs(ae,{className:"flex-grow pb-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:i}),e.jsxs("p",{className:"text-sm text-muted-foreground line-clamp-3",children:["UUID:",r]})]}),e.jsx(te,{className:"pt-2 mt-auto",children:e.jsx(ce,{state:n,onAction:a,pendingAction:t})})]})}function me(){const{setOpen:s}=D();return e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{className:"space-x-1",onClick:()=>s("create"),children:[e.jsx("span",{children:"创建场景"})," ",e.jsx(G,{size:18})]})})}const xe=(s,i,n)=>{const{scenario:a,updateState:t,isUpdatingState:r}=P(s),{setOpen:x,setCurrentRow:o}=D(),h=B(),[v,c]=m.useState(null);return m.useEffect(()=>{r||c(null)},[r]),{handleAction:m.useCallback(d=>{if(a)switch(d){case"enter":h({to:"/scenarios/$scenarioId",params:{scenarioId:s}});break;case"build":o(a),c("build"),t({modelId:s,data:{action:d}}),i(s);break;case"force_stop_build":o(a),c("force_stop_build"),t({modelId:s,data:{action:d}});break;case"start":o(a),c("start"),t({modelId:s,data:{action:d}});break;case"stop":o(a),c("stop"),t({modelId:s,data:{action:d}}),n();break;case"delete":o(a),n(),x("delete");break;case"view_details":o(a),x("update");break}},[s,t,x,a,o,h,i,n]),pendingAction:v}};function ue({logs:s,isBuilding:i,className:n}){return e.jsxs("div",{className:k("flex flex-col rounded-lg border bg-card p-4 shadow-sm w-full",n),children:[e.jsxs("h3",{className:"mb-2 flex items-center text-lg font-semibold",children:[e.jsx(z,{className:"mr-2"}),"构建日志",i&&e.jsx("span",{className:"ml-3 animate-pulse text-sm text-primary",children:"正在构建场景镜像..."})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(R,{logs:s,className:"w-full h-full"})})]})}function pe(){const{scenarios:s}=re(),[i,n]=m.useState("ascending"),[a,t]=m.useState("all"),[r,x]=m.useState(""),{logs:o,isBuilding:h,createBuildConnection:v,closeBuildConnection:c,isLogVisible:u,setIsLogVisible:d}=W("scenario"),C=s?s.sort((l,j)=>i==="ascending"?l.name.localeCompare(j.name):j.name.localeCompare(l.name)).filter(l=>a==="all"?!0:l.state===a).filter(l=>l.name.toLowerCase().includes(r.toLowerCase())):[];return e.jsxs(ie,{children:[e.jsxs(F,{children:[e.jsx(E,{}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsx(M,{}),e.jsx(O,{})]})]}),e.jsxs(U,{fixed:!0,className:"overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"由AI Agent驱动的攻防场景"}),e.jsx("p",{className:"text-muted-foreground",children:"这里列出了所有由AI Agent驱动的攻防场景"})]}),e.jsx(me,{})]}),e.jsxs("div",{className:"my-4 flex items-end justify-between sm:my-0 sm:items-center",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:my-4 sm:flex-row",children:[e.jsx(H,{placeholder:"搜索场景名称...",className:"h-9 w-40 lg:w-[250px]",value:r,onChange:l=>x(l.target.value)}),e.jsxs(w,{value:a,onValueChange:t,children:[e.jsx(y,{className:"w-36",children:e.jsx(T,{children:a==="all"?"所有场景容器":b[a].label})}),e.jsxs(I,{children:[e.jsx(g,{value:"all",children:"所有场景容器"}),Object.entries(b).map(([l,j])=>e.jsx(g,{value:l,children:j.label},l))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>d(!u),children:[e.jsx(z,{size:16,className:"mr-2"}),u?"隐藏日志":"显示日志",e.jsx(J,{size:16,className:`ml-2 transition-transform ${u?"rotate-180":""}`})]}),e.jsxs(w,{value:i,onValueChange:n,children:[e.jsx(y,{className:"w-16",children:e.jsx(T,{children:e.jsx(K,{size:18})})}),e.jsxs(I,{align:"end",children:[e.jsx(g,{value:"ascending",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:"升序"})]})}),e.jsx(g,{value:"descending",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Y,{size:16}),e.jsx("span",{children:"降序"})]})})]})]})]})]}),e.jsx(V,{className:"shadow-sm"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 py-4",children:[u&&e.jsx(ue,{logs:o,isBuilding:h,className:"h-80"}),C.length>0?e.jsx("ul",{className:"  grid gap-4 overflow-auto pb-16 md:grid-cols-1 lg:grid-cols-2 xl:grid-cols-3",children:C.map(l=>e.jsx("li",{children:e.jsx(fe,{scenario:l,createBuildConnection:v,closeBuildConnection:c})},l.uuid))}):e.jsx("div",{className:" text-muted-foreground",children:"没有找到创建好的场景，请点击右上角创建场景"})]})]}),e.jsx(ne,{}),e.jsx(le,{})]})}function fe({scenario:s,createBuildConnection:i,closeBuildConnection:n}){const{status:a}=P(s.uuid),{handleAction:t,pendingAction:r}=xe(s.uuid,i,n);return a&&(s.state=a.state),e.jsx(de,{...s,onAction:t,pendingAction:r})}const $e=pe;export{$e as component};
